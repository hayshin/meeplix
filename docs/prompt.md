**Задача:** Разработать минимально жизнеспособный продукт (MVP) веб-версии настольной игры "Имаджинариум" со следующими ключевыми функциями: создание/присоединение к игре, многопользовательский режим через WebSockets, базовая игровая логика (выбор ведущего, ассоциация, выбор карт, голосование, подсчёт очков), и простой пользовательский интерфейс.

**Цель MVP:** Продемонстрировать основной игровой процесс и убедиться в работоспособности ключевых технических решений. Генерация изображений ИИ откладывается до после MVP; используются заранее определённые карты.

**Ход игры:**

1. Раздается по шесть карт каждому игроку
2. Выбирается ведущий (по умолчанию тот, кто зашёл первый, в будущем изменим это)
3. Ведущий выбирает карту и ассоциацию, отправляет
4. Остальные участники получают ассоциацию, и должны выбрать карту, которую хотят отправить.
5. После того, как карта отправляется игроком, она отображается рубашкой вверх на столе (по центру экрана)
6. Далее, когда все игроки выбрали карты, они переворачиваются. Начинается фаза голосования
7. Каждый игрок может проголосовать за одну карту, которая по его мнению является картой ведущего.
8. После того, как все участники проголосуют, голоса вскрываются (становятся видны)
9. Фаза подсчёта очков - ведущий получает три очка, если кто-то проголосовал за него (но не все, и не ноль). Игроки получают три очка, если они угадали ведущего. И игроки, и ведущий получают по очку за каждый голос (ведущий получает только если кто-то не угадал его карту).
10. Роль ведущего переходит к следующему игроку, вместо выброшенных карт игроки получают новые.

Игра идёт или до определённого количества раундов, или до определённого количества очков.

**Технологический Стек:**

- **Фронтенд:** SvelteKit, TypeScript, Lucide-svelte, Bits-UI, i18n, TailwindCSS.
- **Бэкенд:** ElysiaJS, TypeScript, Drizzle-ORM (PostgreSQL для постоянных данных, SQLite для локальной разработки MVP).
- **База данных:** PostgreSQL (для продакшена), SQLite (для MVP локально).
- **Хостинг (будущий):** Azure.

**Функциональные Требования MVP:**

1.  **Главная страница:**

    - Поле для ввода никнейма.
    - Кнопка "Создать игру".
    - Никнейм сохраняется в LocalStorage.

2.  **Создание и Присоединение к Игре:**

    - При создании игры: бэкенд генерирует уникальный UUID для сессии и создает WebSocket-комнату. Фронтенд перенаправляет на URL `yourgame.com/game/{uuid}`.
    - Присоединение: Пользователь переходит по URL, при необходимости вводит никнейм (всплывающее окно), устанавливает WebSocket-соединение с бэкендом.
    - Игроки в сессии идентифицируются по никнейму и ID сессии.

3.  **Игровой экран:**

    - **Список игроков:** Слева сверху, отображает никнеймы, показывает текущего ведущего. Порядок ведущего по порядку подключения.
    - **Карты на столе** Отображает нынешние карты на столе во время голосования. Во время выбора, отображает карты рубашками вверх.
    - **Статусная строка:** Сверху, динамические уведомления о ходе игры.
    - **Карты игрока:** Снизу, "рука" карт из 6 предопределённых изображений.

4.  **Игровая логика и UI/UX (Поэтапно):**
    - **Фаза Ведущего:**
      - _Ведущему:_ Уведомление "Вам необходимо выбрать карту и ввести для неё ассоциацию/связь." UI для выбора карты и ввода текста.
      - _Остальным:_ Уведомление "Сейчас {никнейм_ведущего} ведущий. Пожалуйста, подождите..."
    - **Фаза Выбора Карт (не-ведущими):**
      - _Всем (после выбора ведущего):_ Уведомление "Ассоциация: '{ассоциация_ведущего}'" и "Выберите карту, похожую на эту ассоциацию...". UI для выбора карты. Карты, которые выбраны, отображаются рубашкой вверх.
    - **Ожидание:** "Ожидание выбора карт от других игроков..." (в статусной строке).
    - **Фаза Голосования:**
      - Все выбранные карты (включая карту ведущего) отображаются по центру экрана (перемешанные).
      - _UI для карт:_ При нажатии карта увеличивается. **Метод выбора для голосования:** Двойной клик/тап по карте или кнопка "Выбрать эту карту" под увеличенной картой.
      - Уведомление "Выберите карту, по которой вы предполагаете, что это карта ведущего."
    - **Подсчёт очков:**
      - На каждой карте, за которую проголосовали, всплывают аватарки проголосовавших.
      - Таблица с общими очками и очками за раунд (+{число}).
      - Правила подсчёта:
        - Ведущий: 3 очка, если не все угадали И не никто не угадал его карту. 0 очков в противном случае.
        - Другие игроки: 3 очка, если угадали карту ведущего. 1 очко за каждый голос за их карту (если это не карта ведущего).
    - **Конец игры:** Когда игрок достигает 20 очков.

**Технические Детали для ИИ-агента:**

- **База данных (Drizzle-ORM):**
  - Определить схемы для `gameSessions` и `users` как описано выше.
  - Реализовать CRUD-операции для этих сущностей.
- **WebSockets (ElysiaJS):**
  - Настроить WebSocket-сервер на `ws /game/:uuid`.
  - Реализовать обработчики для следующих событий: `connection`, `disconnect`, `leaderSelectsCardAndAssociation`, `playerSubmitsCard`, `playerVotes`.
  - Обеспечить broadcast-рассылку сообщений внутри комнаты.
- **Логика игры на бэкенде:**
  - Управление состоянием игры (`gameSession.status`, `currentRound`, `leaderPlayerId`).
  - Распределение предопределённых карт игрокам в начале раунда.
  - Хранение выборов игроков и голосов в `gameSession.roundData`.
  - Алгоритм подсчёта очков.
  - Определение следующего ведущего.
- **Фронтенд (SvelteKit):**
  - Использование `$app/stores` для управления состоянием игры.
  - Компоненты для списка игроков, статусной строки, руки карт, карт на столе, таблицы очков.
  - Интеграция с WebSocket API ElysiaJS.
  - Использование Lucide-svelte для иконок, Bits-UI для интерактивных элементов, TailwindCSS для стилей.
  - Реализация логики всплывающего окна для ника.
  - Логика сохранения ника в LocalStorage.

**Вопросы для уточнения (если применимо):**

- Как будет обрабатываться отключение ведущего игрока? (для MVP - можно игнорировать или просто сбрасывать игру)

**Ключевые принципы:**

- Максимальная простота для MVP.
- Использование TypeScript на всём стеке для надёжности.
- Аккуратное разделение ответственности между фронтендом и бэкендом.
